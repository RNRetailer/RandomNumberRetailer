<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <!--[if IE]>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <![endif]-->
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- Page title -->
      <title>Sepolia Random Number Retailer Test</title>
      <!--[if lt IE 9]>
      <script src="js/respond.js"></script>
      <![endif]-->
      <!-- Bootstrap Core CSS -->
      <link href="css/bootstrap.css" rel="stylesheet" type="text/css">
      <!-- Icon fonts -->
      <link href="fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
      <link href="fonts/flaticons/flaticon.css" rel="stylesheet" type="text/css">
      <link href="fonts/glyphicons/bootstrap-glyphicons.css" rel="stylesheet" type="text/css">
      <!-- Google fonts -->
      <link href="https://fonts.googleapis.com/css?family=Lato:400,800" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Baloo+Thambi" rel="stylesheet">
      <!-- Style CSS -->
      <link href="css/style.css" rel="stylesheet">
      <!-- Plugins CSS -->
      <link rel="stylesheet" href="css/plugins.css">
      <!-- Color Style CSS -->
      <link href="styles/maincolors.css" rel="stylesheet">
      <!-- Favicons-->
      <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
      <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
   </head>
   <body id="page-top">
      <!-- Preloader -->
      <div id="preloader">
         <div class="spinner">
            <div class="bounce1"></div>
         </div>
      </div>
      <!-- Preloader ends -->
      <nav class="navbar navbar-custom navbar-fixed-top">
         <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
               <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-brand-centered">
               <i class="fa fa-bars"></i>
               </button>
               <div class="navbar-brand navbar-brand-centered page-scroll">
                  <a href="#page-top">
                     <!-- logo  -->
                     <img src="img/logo.png" class="img-responsive" alt="">
                  </a>
               </div>
            </div>
            <!--/navbar-header -->
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-brand-centered">
            </div>
            <!-- /.navbar-collapse -->
         </div>
         <!-- /.container -->
      </nav>
      <!-- /navbar ends -->
      <!-- ==== Slider ==== -->
      <div class="container-fluid parallax-header"  
         data-stellar-background-ratio="0.5">
         <div class="container">
            <div class="col-sm-5 text-light text-center bg-darkcolor" data--100-start="margin-top:100px;transform:scale(1)" data--100-top="margin-top:0px;transform:scale(0.7);">
               <h1>Sepolia Random Number Retailer Test Panel</h1>
               <!--the div below is hidden on small screens  -->
               <div class="hidden-xs">
                  <p class="header-p">
					Use this Sepolia Random Number Retailer Test Panel to test the Sepolia Random Number Retailer smart contract.
				  </p>
                  <a class="btn btn-primary " href="#admin-panel-index">Go To Sepolia Random Number Retailer Test Panel</a>
               </div>
               <!--/d-none  -->
            </div>
         </div>
      </div>
      <!-- /container-fluid -->  
      <!-- SVG Curve Up -->
      <svg id="curveUp" xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100" viewBox="0 0 100 100" preserveAspectRatio="none" fill="#fff">
         <path d="M0 100 C 20 0 50 0 100 100 Z"/>
      </svg>
      <!-- Section Services-index -->
      <section id="admin-panel-index" class="bg-pattern" data-bottom-top="background-position: 0px 10%,99% 10%;"
         data-top-bottom="background-position: 0px 80%,99% 80%;">
         <!-- container -->
         <div class="container">
            <div class="section-heading">
               <h2>Sepolia Random Number Retailer Test Panel</h2>
            </div>
            <!-- /section-heading-->
            <div class="col-md-7">
			 <p style="margin-bottom:30px;">
			 <h6>Connect MetaMask then click the buttons to perform actions.</h6>
			 </p>
			
			 <form class="form-horizontal">	
				<!-- Button -->
				<div id="connectWalletButtonHolder" class="form-group" style="display:none;">
				   <div class="col-md-6">
					  <button type="button" onclick="connectWallet()" id="connectWalletButton" name="singlebutton" class="btn btn-primary">Connect Wallet</button>
				   </div>
				</div>
				<div class="form-group" style="margin-bottom:15px;">
				   <div class="col-md-6">
					  <button type="button" onclick="requestRandomNumbersSynchronous()" id="requestRandomNumbersSynchronousButton" name="requestRandomNumbersSynchronousButton" class="btn btn-primary">Request Random Numbers Synchronous</button>
				   </div>
				</div>
			 </form>
			 
			</div>
            <!-- /col-md-->
            <div class="col-md-5">
               <img src="img/servicesintro.png" class="img-responsive" alt="">
            </div>
            <!-- /col-md-->
         </div>
         <!-- /container-->
         
      <!-- /footer ends -->
      <!-- Core JavaScript Files -->
      <script src="js/jquery.min.js"></script>
      <script src="js/bootstrap.min.js"></script>
      <!-- Main Js -->
      <script src="js/main.js"></script>
      <!-- Contact form -->
      <script src="js/contact.js"></script>
      <!--Other Plugins -->
      <script src="js/plugins.js"></script>
      <!-- Prefix free CSS -->
      <script src="js/prefixfree.js"></script>
      <!--Mail Chimp validator -->
      <script src='js/mc-validate.js'></script>	  
      <!-- Open street maps-->
      <script src="js/map.js"></script>
	  
	  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

	  <script>
	    const abi = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "blockNum",
				"type": "uint256"
			}
		],
		"name": "BlockhashNotInStore",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			}
		],
		"name": "OwnershipTransferRequested",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "requestId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "outputSeed",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint96",
				"name": "payment",
				"type": "uint96"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "success",
				"type": "bool"
			}
		],
		"name": "RandomWordsFulfilled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "requestor",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "weiPaid",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amountOfRandomNumbersReturned",
				"type": "uint256"
			}
		],
		"name": "RandomWordsReturnedSync",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "BLOCKHASH_STORE",
		"outputs": [
			{
				"internalType": "contract BlockhashStoreInterface",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "acceptOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "contractIsPaused",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"components": [
					{
						"internalType": "uint256[2]",
						"name": "pk",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256[2]",
						"name": "gamma",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256",
						"name": "c",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "s",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "seed",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "uWitness",
						"type": "address"
					},
					{
						"internalType": "uint256[2]",
						"name": "cGammaWitness",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256[2]",
						"name": "sHashWitness",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256",
						"name": "zInv",
						"type": "uint256"
					}
				],
				"internalType": "struct VRF.Proof",
				"name": "proof",
				"type": "tuple"
			},
			{
				"components": [
					{
						"internalType": "uint64",
						"name": "blockNum",
						"type": "uint64"
					},
					{
						"internalType": "uint256",
						"name": "subId",
						"type": "uint256"
					},
					{
						"internalType": "uint32",
						"name": "callbackGasLimit",
						"type": "uint32"
					},
					{
						"internalType": "uint32",
						"name": "numWords",
						"type": "uint32"
					},
					{
						"internalType": "address",
						"name": "sender",
						"type": "address"
					},
					{
						"internalType": "bytes",
						"name": "extraArgs",
						"type": "bytes"
					}
				],
				"internalType": "struct RandomNumberRetailer.RequestCommitment",
				"name": "rc",
				"type": "tuple"
			}
		],
		"name": "fulfillRandomWords",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256[2]",
				"name": "publicKey",
				"type": "uint256[2]"
			}
		],
		"name": "hashOfKey",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minimumHealthyLengthOfRandomNumbersArray",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minimumViablePriceOfARandomNumberInWei",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "mostRecentRequestId",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bool",
				"name": "shouldBePaused",
				"type": "bool"
			}
		],
		"name": "pauseOrUnpauseContract",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "priceMultiplier",
		"outputs": [
			{
				"internalType": "uint8",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "priceOfARandomNumberInWei",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "randomNumbersAvailable",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "amountOfRandomNumbersAvailable",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "replacementContractAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amountOfRandomNumbersToRequest",
				"type": "uint256"
			},
			{
				"internalType": "uint256[]",
				"name": "randomSeedArray",
				"type": "uint256[]"
			}
		],
		"name": "requestRandomNumbersSynchronous",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "randomNumbersToReturn",
				"type": "uint256[]"
			}
		],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "amountOfRandomNumbersToRequest",
				"type": "uint256"
			},
			{
				"components": [
					{
						"internalType": "uint256[2]",
						"name": "pk",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256[2]",
						"name": "gamma",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256",
						"name": "c",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "s",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "seed",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "uWitness",
						"type": "address"
					},
					{
						"internalType": "uint256[2]",
						"name": "cGammaWitness",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256[2]",
						"name": "sHashWitness",
						"type": "uint256[2]"
					},
					{
						"internalType": "uint256",
						"name": "zInv",
						"type": "uint256"
					}
				],
				"internalType": "struct VRF.Proof",
				"name": "proof",
				"type": "tuple"
			},
			{
				"components": [
					{
						"internalType": "uint64",
						"name": "blockNum",
						"type": "uint64"
					},
					{
						"internalType": "uint256",
						"name": "subId",
						"type": "uint256"
					},
					{
						"internalType": "uint32",
						"name": "callbackGasLimit",
						"type": "uint32"
					},
					{
						"internalType": "uint32",
						"name": "numWords",
						"type": "uint32"
					},
					{
						"internalType": "address",
						"name": "sender",
						"type": "address"
					},
					{
						"internalType": "bytes",
						"name": "extraArgs",
						"type": "bytes"
					}
				],
				"internalType": "struct RandomNumberRetailer.RequestCommitment",
				"name": "rc",
				"type": "tuple"
			}
		],
		"name": "requestRandomNumbersSynchronousUsingVRFv2Seed",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "randomNumbersToReturn",
				"type": "uint256[]"
			}
		],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amountOfGasUsedForAFulfillRandomNumbersTransaction",
				"type": "uint256"
			}
		],
		"name": "setAmountOfGasUsedForAFulfillRandomNumbersTransaction",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_maximumCostOfSendInWei",
				"type": "uint256"
			}
		],
		"name": "setMaximumCostOfSendInWei",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint32",
				"name": "_maximumNumbersThatCanBeFulfilledInOneTransaction",
				"type": "uint32"
			}
		],
		"name": "setMaximumNumbersThatCanBeFulfilledInOneTransaction",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_minimumHealthyLengthOfRandomNumbersArray",
				"type": "uint256"
			}
		],
		"name": "setMinimumHealthyLengthOfRandomNumbersArray",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_minimumServerBalanceInWei",
				"type": "uint256"
			}
		],
		"name": "setMinimumServerBalanceInWei",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_minimumViablePriceOfARandomNumberInWei",
				"type": "uint256"
			}
		],
		"name": "setMinimumViablePriceOfARandomNumberInWei",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint8",
				"name": "_priceMultiplier",
				"type": "uint8"
			}
		],
		"name": "setPriceMultiplier",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_replacementContractAddress",
				"type": "address"
			}
		],
		"name": "setReplacementContractAddress",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "weiToWithdraw",
				"type": "uint256"
			}
		],
		"name": "withdrawETHToOwner",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
		
		const rnrContractAddress = '0xd058eA7e3DfE100775Ce954F15bB88257CC10191';
		const chainID = 11155111;
	  
	    async function connectWallet(){
		  if (window.ethereum) {
			window.ethereumAddresses = await window.ethereum.request({method: 'eth_requestAccounts'});
			window.web3 = new Web3(window.ethereum);
			await switchNetwork(chainID);
			window.rnrContract = new window.web3.eth.Contract(abi, rnrContractAddress);
			return true;
		  }
		  alert("Please install MetaMask to use this website. Check the How To Play page if you don't know how. Thanks!");
		  return false;
		}
		
		async function switchNetwork(chainId){
			const currentChainId = await web3.eth.getChainId();
			
			if (currentChainId != chainId){
				try {
					await ethereum.request({
						method:'wallet_switchEthereumChain',
						params: [{chainId: Web3.utils.toHex(chainId)}]
					});
					console.log(`switched to chainid : ${chainId} succesfully`);
					return true;
				}catch(err){
					console.log(`error occured while switching chain to chainId ${chainId}, err: ${err.message} code: ${err.code}`);
					return false;
				}
			}
			else{
			    return true;
			}
        }
		
		window.onload = (event) => {
		    isConnected();
		};
		
		async function metamaskAccountsExist(){
			if (window.ethereum){
				const accounts = await window.ethereum.request({method: 'eth_accounts'}); 

				if (accounts.length) {
					return true;
				} 
				else {
					return false;
				}
			}
			else {
				return false;
			}
		}
            
	    async function isConnected() {
			const doAccountsExist = await metamaskAccountsExist();
		
		    if (doAccountsExist){
				console.log(`You're connected to MetaMask`);
				window.ethereumAddresses = await window.ethereum.request({method: 'eth_requestAccounts'});
			    window.web3 = new Web3(window.ethereum);
				await switchNetwork(chainID);
			    window.rnrContract = new window.web3.eth.Contract(abi, rnrContractAddress);
			}
			else {
				$('#connectWalletButtonHolder').css('display', '');
			}
		}
		
		async function requestRandomNumbersSynchronous(){
			let amountOfRandomNumbersToRequest = prompt("How many random numbers do you want?");
			
			if (amountOfRandomNumbersToRequest == null){
			    return;
			}
			
			amountOfRandomNumbersToRequest = web3.utils.toBigInt(amountOfRandomNumbersToRequest);
						
			let randomSeedArrayLength = prompt("How many random seeds will you use?");
			
			if (randomSeedArrayLength == null){
			    return;
			}
			
			randomSeedArrayLength = Number(randomSeedArrayLength);
			
			let randomSeedArray = [];
			
			for(let i=0; i < randomSeedArrayLength; i++){
			    randomSeedArray.push(
				    web3.utils.hexToNumber(
					    web3.utils.randomHex(32)
					)
				);
			}
			
			const priceOfARandomNumberInWei = await window.rnrContract.methods.priceOfARandomNumberInWei().call()
			const weiToPay = amountOfRandomNumbersToRequest * priceOfARandomNumberInWei;
			
			window.rnrContract.methods.requestRandomNumbersSynchronous(amountOfRandomNumbersToRequest, randomSeedArray).send({
				'from': window.ethereumAddresses[0],
				'value': weiToPay
			})
			.on('confirmation', function(confirmationNumber, receipt){
			    if (confirmationNumber == 1){
				    alert('requestRandomNumbersSynchronous successful!');
				}
			})
			.on('error', function(error, receipt){
			    alert('requestRandomNumbersSynchronous failed. Please try again.');
			});
			
		}
	  </script>
   </body>
</html>
